
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for src/components/SubscriptionDialog.tsx</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../index.html">All files</a> / <a href="index.html">src/components</a> SubscriptionDialog.tsx</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" ><span class="branch-0 cbranch-no" title="branch not covered" >import { useState } from 'react';import {  Dialog,  DialogContent,  DialogDescription,  DialogFooter,  DialogHeader,  DialogTitle,} from '@/components/ui/dialog';import { Button } from '@/components/ui/button';import { Badge } from '@/components/ui/badge';import { Alert, AlertDescription } from '@/components/ui/alert';import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';import { useSubscriptions } from '@/hooks/useSubscriptions';import { usePaymentMethods } from '@/hooks/usePaymentMethods';import {   CreditCard,   Calendar,   CheckCircle,   AlertTriangle,   Crown,  Star,  Zap} from 'lucide-react';import { format } from 'date-fns';import { es } from 'date-fns/locale';interface SubscriptionDialogProps {  open: boolean;  onOpenChange: (open: boolean) =&gt; void;}export default function SubscriptionDialog({ open, onOpenChange }: SubscriptionDialogProps) {  const {     currentSubscription,     subscriptionHistory,     loading,     subscribe,     changePlan,     cancelSubscription,     reactivateSubscription   } = useSubscriptions();  const { paymentMethods } = usePaymentMethods();    const [selectedPlan, setSelectedPlan] = useState&lt;string | null&gt;(null);  const [showPlanSelector, setShowPlanSelector] = useState(false);  const [showCancelDialog, setShowCancelDialog] = useState(false);  const plans = [    {      id: 'basic',      name: 'Básico',      price: 9.99,      icon: Star,      features: [        'Acceso a contenido estándar',        '1 pantalla simultánea',        'Calidad HD',        'Sin anuncios'      ]    },    {      id: 'standard',      name: 'Estándar',      price: 14.99,      icon: Crown,      features: [        'Acceso a todo el contenido',        '2 pantallas simultáneas',        'Calidad Full HD',        'Sin anuncios',        'Descargas offline'      ]    },    {      id: 'premium',      name: 'Premium',      price: 19.99,      icon: Zap,      features: [        'Acceso a todo el contenido premium',        '4 pantallas simultáneas',        'Calidad 4K',        'Sin anuncios',        'Descargas offline',        'Contenido exclusivo'      ]    }  ];  const getStatusBadge = (status: string) =&gt; {    const variants = {      active: 'default',      cancelled: 'destructive',      expired: 'secondary'    } as const;        const labels = {      active: 'Activa',      cancelled: 'Cancelada',      expired: 'Expirada'    };    return (      &lt;Badge variant={variants[status as keyof typeof variants] || 'secondary'}&gt;        {labels[status as keyof typeof labels] || status}      &lt;/Badge&gt;    );  };  const getPlanIcon = (planId: string) =&gt; {    const plan = plans.find(p =&gt; p.id === planId);    if (!plan) return Star;    return plan.icon;  };  const handleSubscribe = async (planId: string) =&gt; {    if (paymentMethods.length === 0) {      alert('Necesitas agregar un método de pago primero');      return;    }    const success = await subscribe(planId as 'basic' | 'standard' | 'premium');    if (success) {      setShowPlanSelector(false);      setSelectedPlan(null);    }  };  const handleChangePlan = async (newPlanId: string) =&gt; {    if (!currentSubscription) return;        const success = await changePlan(newPlanId as 'basic' | 'standard' | 'premium');    if (success) {      setShowPlanSelector(false);      setSelectedPlan(null);    }  };  const handleCancel = async () =&gt; {    if (!currentSubscription) return;        const success = await cancelSubscription();    if (success) {      setShowCancelDialog(false);    }  };  const handleReactivate = async () =&gt; {    if (!currentSubscription) return;        await reactivateSubscription();  };  return (    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;      &lt;DialogContent className="sm:max-w-[700px] max-h-[90vh] overflow-y-auto"&gt;        &lt;DialogHeader&gt;          &lt;DialogTitle className="flex items-center gap-2"&gt;            &lt;CreditCard className="w-5 h-5" /&gt;            Gestión de suscripción          &lt;/DialogTitle&gt;          &lt;DialogDescription&gt;            Administra tu plan de suscripción y revisa tu historial          &lt;/DialogDescription&gt;        &lt;/DialogHeader&gt;        &lt;div className="space-y-6"&gt;          {/* Suscripción actual */}          &lt;div className="space-y-4"&gt;            &lt;h4 className="font-medium"&gt;Suscripción actual&lt;/h4&gt;            {currentSubscription ? (              &lt;Card&gt;                &lt;CardContent className="p-4"&gt;                  &lt;div className="flex items-center justify-between mb-4"&gt;                    &lt;div className="flex items-center gap-3"&gt;                      {(() =&gt; {                        const IconComponent = getPlanIcon(currentSubscription.plan);                        return &lt;IconComponent className="w-6 h-6 text-primary" /&gt;;                      })()}                      &lt;div&gt;                        &lt;h5 className="font-medium"&gt;                          Plan {plans.find(p =&gt; p.id === currentSubscription.plan)?.name || currentSubscription.plan}                        &lt;/h5&gt;                        &lt;p className="text-sm text-muted-foreground"&gt;                          ${c</span></span>urrentSubscription.price}/mes                        &lt;/p&gt;                      &lt;/div&gt;                    &lt;/div&gt;                    {getStatusBadge(currentSubscription.status)}                  &lt;/div&gt;                  &lt;div className="space-y-2 text-sm text-muted-foreground"&gt;                    &lt;div className="flex items-center gap-2"&gt;                      &lt;Calendar className="w-4 h-4" /&gt;                      &lt;span&gt;                        Inicio: {format(new Date(currentSubscription.start_date), "dd 'de' MMMM, yyyy", { locale: es })}                      &lt;/span&gt;                    &lt;/div&gt;                    {currentSubscription.end_date &amp;&amp; (                      &lt;div className="flex items-center gap-2"&gt;                        &lt;Calendar className="w-4 h-4" /&gt;                        &lt;span&gt;                          {currentSubscription.status === 'cancelled' ? 'Expira' : 'Próximo cobro'}: {format(new Date(currentSubscription.end_date), "dd 'de' MMMM, yyyy", { locale: es })}                        &lt;/span&gt;                      &lt;/div&gt;                    )}                  &lt;/div&gt;                  &lt;div className="flex gap-2 mt-4"&gt;                    {currentSubscription.status === 'active' &amp;&amp; (                      &lt;&gt;                        &lt;Button                          variant="outline"                          size="sm"                          onClick={() =&gt; setShowPlanSelector(true)}                        &gt;                          Cambiar plan                        &lt;/Button&gt;                        &lt;Button                          variant="outline"                          size="sm"                          onClick={() =&gt; setShowCancelDialog(true)}                        &gt;                          Cancelar suscripción                        &lt;/Button&gt;                      &lt;/&gt;                    )}                    {currentSubscription.status === 'cancelled' &amp;&amp; (                      &lt;Button                        size="sm"                        onClick={handleReactivate}                        disabled={loading}                      &gt;                        Reactivar suscripción                      &lt;/Button&gt;                    )}                  &lt;/div&gt;                &lt;/CardContent&gt;              &lt;/Card&gt;            ) : (              &lt;Card&gt;                &lt;CardContent className="p-6 text-center"&gt;                  &lt;p className="text-muted-foreground mb-4"&gt;No tienes una suscripción activa&lt;/p&gt;                  &lt;Button onClick={() =&gt; setShowPlanSelector(true)}&gt;                    Ver planes disponibles                  &lt;/Button&gt;                &lt;/CardContent&gt;              &lt;/Card&gt;            )}          &lt;/div&gt;          {/* Selector de planes */}          {showPlanSelector &amp;&amp; (            &lt;div className="space-y-4"&gt;              &lt;h4 className="font-medium"&gt;                {currentSubscription ? 'Cambiar plan' : 'Seleccionar plan'}              &lt;/h4&gt;              &lt;div className="grid gap-4 md:grid-cols-3"&gt;                {plans.map((plan) =&gt; {                  const IconComponent = plan.icon;                  const isCurrentPlan = currentSubscription?.plan === plan.id;                                    return (                    &lt;Card                       key={plan.id}                       className={`cursor-pointer transition-all ${                        selectedPlan === plan.id ? 'ring-2 ring-primary' : ''                      } ${isCurrentPlan ? 'opacity-50' : ''}`}                      onClick={() =&gt; !isCurrentPlan &amp;&amp; setSelectedPlan(plan.id)}                    &gt;                      &lt;CardHeader className="text-center"&gt;                        &lt;IconComponent className="w-8 h-8 mx-auto text-primary" /&gt;                        &lt;CardTitle className="text-lg"&gt;{plan.name}&lt;/CardTitle&gt;                        &lt;div className="text-2xl font-bold"&gt;${plan.price}&lt;span className="text-sm font-normal"&gt;/mes&lt;/span&gt;&lt;/div&gt;                        {isCurrentPlan &amp;&amp; (                          &lt;Badge variant="default"&gt;Plan actual&lt;/Badge&gt;                        )}                      &lt;/CardHeader&gt;                      &lt;CardContent&gt;                        &lt;ul className="space-y-2 text-sm"&gt;                          {plan.features.map((feature, index) =&gt; (                            &lt;li key={index} className="flex items-center gap-2"&gt;                              &lt;CheckCircle className="w-4 h-4 text-green-500" /&gt;                              {feature}                            &lt;/li&gt;                          ))}                        &lt;/ul&gt;                      &lt;/CardContent&gt;                    &lt;/Card&gt;                  );                })}              &lt;/div&gt;                            &lt;div className="flex gap-2"&gt;                &lt;Button                  variant="outline"                  onClick={() =&gt; {                    setShowPlanSelector(false);                    setSelectedPlan(null);                  }}                &gt;                  Cancelar                &lt;/Button&gt;                {selectedPlan &amp;&amp; (                  &lt;Button                    onClick={() =&gt; currentSubscription ? handleChangePlan(selectedPlan) : handleSubscribe(selectedPlan)}                    disabled={loading}                  &gt;                    {loading ? 'Procesando...' : currentSubscription ? 'Cambiar plan' : 'Suscribirse'}                  &lt;/Button&gt;                )}              &lt;/div&gt;            &lt;/div&gt;          )}          {/* Diálogo de confirmación de cancelación */}          {showCancelDialog &amp;&amp; (            &lt;Alert&gt;              &lt;AlertTriangle className="w-4 h-4" /&gt;              &lt;AlertDescription className="space-y-3"&gt;                &lt;p&gt;¿Estás seguro de que quieres cancelar tu suscripción?&lt;/p&gt;                &lt;p className="text-sm"&gt;                  Podrás seguir disfrutando del servicio hasta el final de tu período de facturación actual.                &lt;/p&gt;                &lt;div className="flex gap-2"&gt;                  &lt;Button                    variant="outline"                    size="sm"                    onClick={() =&gt; setShowCancelDialog(false)}                  &gt;                    No, mantener suscripción                  &lt;/Button&gt;                  &lt;Button                    variant="destructive"                    size="sm"                    onClick={handleCancel}                    disabled={loading}                  &gt;                    {loading ? 'Cancelando...' : 'Sí, cancelar'}                  &lt;/Button&gt;                &lt;/div&gt;              &lt;/AlertDescription&gt;            &lt;/Alert&gt;          )}          {/* Historial de suscripciones */}          {subscriptionHistory.length &gt; 0 &amp;&amp; (            &lt;div className="space-y-4"&gt;              &lt;h4 className="font-medium"&gt;Historial de suscripciones&lt;/h4&gt;              &lt;div className="space-y-3"&gt;                {subscriptionHistory.map((sub) =&gt; (                  &lt;Card key={sub.id}&gt;                    &lt;CardContent className="p-4"&gt;                      &lt;div className="flex items-center justify-between"&gt;                        &lt;div className="flex items-center gap-3"&gt;                          {(() =&gt; {                            const IconComponent = getPlanIcon(sub.plan);                            return &lt;IconComponent className="w-5 h-5 text-muted-foreground" /&gt;;                          })()}                          &lt;div&gt;                            &lt;div className="flex items-center gap-2"&gt;                              &lt;span className="font-medium"&gt;                                Plan {plans.find(p =&gt; p.id === sub.plan)?.name || sub.plan}                              &lt;/span&gt;                              &lt;Badge variant="secondary" className="text-xs"&gt;                                {sub.action === 'subscribed' ? 'Suscrito' :                                  sub.action === 'cancelled' ? 'Cancelado' :                                  sub.action === 'renewed' ? 'Renovado' : 'Actualizado'}                              &lt;/Badge&gt;                            &lt;/div&gt;                            &lt;div className="text-sm text-muted-foreground"&gt;                              {format(new Date(sub.date), "dd 'de' MMMM, yyyy", { locale: es })} - {sub.details}                            &lt;/div&gt;                          &lt;/div&gt;                        &lt;/div&gt;                        &lt;div className="text-right"&gt;                          &lt;div className="font-medium"&gt;${sub.price}/mes&lt;/div&gt;                        &lt;/div&gt;                      &lt;/div&gt;                    &lt;/CardContent&gt;                  &lt;/Card&gt;                ))}              &lt;/div&gt;            &lt;/div&gt;          )}        &lt;/div&gt;        &lt;DialogFooter&gt;          &lt;Button variant="outline" onClick={() =&gt; onOpenChange(false)}&gt;            Cerrar          &lt;/Button&gt;        &lt;/DialogFooter&gt;      &lt;/DialogContent&gt;    &lt;/Dialog&gt;  );}</span></pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-08-03T04:33:46.865Z
            </div>
        <script src="../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../sorter.js"></script>
        <script src="../../block-navigation.js"></script>
    </body>
</html>
    